<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TON Wallet Connect</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <img src="icon.png" alt="App Icon" class="app-icon">
    <h1>Connect Your TON Wallet</h1>
    <button id="connectBtn">Connect Wallet</button>
    <p id="walletAddress"></p>
    <ul id="connectedList"></ul>
</div>

<script>
const connectBtn = document.getElementById('connectBtn');
const walletAddress = document.getElementById('walletAddress');
const connectedList = document.getElementById('connectedList');

connectBtn.onclick = async () => {
  try {
    const res = await fetch('/auth-request');
    const data = await res.json();
    window.location.href = data.deeplinkURL;
  } catch(e) {
    console.error("Failed to connect wallet:", e);
  }
};

// Show all connected addresses
async function loadConnectedUsers(){
  try{
    const res = await fetch('/connected-users');
    const users = await res.json();
    connectedList.innerHTML = '';
    users.forEach(u=>{
      const li = document.createElement('li');
      li.textContent = u;
      connectedList.appendChild(li);
    });
  } catch(e){
    console.error(e);
  }
}

// Reload every 5 seconds
setInterval(loadConnectedUsers, 5000);
loadConnectedUsers();
</script>
</body>
</html>
